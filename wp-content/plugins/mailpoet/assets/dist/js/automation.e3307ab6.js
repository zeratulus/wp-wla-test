"use strict";(self.webpackChunkMailPoet3=self.webpackChunkMailPoet3||[]).push([[916],{66609:function(e,n,t){var o=t(52524),r=t.n(o),i=t(45993);const a=window.mailpoet_automation_api,d=`${a.root}/mailpoet/v1/automation`,s=(e,n)=>{const[t,o]=(0,i.useState)({data:void 0,loading:!1,error:void 0});return[(0,i.useCallback)((async t=>{var r;o((e=>({...e,loading:!0})));const i=await((e,n)=>fetch(`${d}/${e}`,n))(e,{...n,...t,headers:{"content-type":"application/json",...null!==(r=null==t?void 0:t.headers)&&void 0!==r?r:{},"x-wp-nonce":a.nonce}});try{const e=await i.json(),n=i.ok?null:{...i,data:e};o((t=>({...t,data:e,error:n})))}catch(e){const n={response:i};o((e=>({...e,error:n})))}finally{o((e=>({...e,loading:!1})))}}),[n,e]),t]},l=e=>e.toString(16).padStart(2,"0"),c=()=>{if(!window.crypto||!window.crypto.getRandomValues)throw new Error("Web Crypto API 'crypto.getRandomValues' is not available");return Array.from(window.crypto.getRandomValues(new Uint8Array(8))).map(l).join("")};var u=t(15451);const m=()=>{const e={id:c(),type:"action",key:"mailpoet:send-welcome-email",args:{welcomeEmailId:1}},n=(t=e.id,{id:c(),type:"action",key:"core:wait",next_step_id:t,args:{seconds:60}});var t;const o=(e=>({id:c(),type:"trigger",key:"mailpoet:segment:subscribed",next_step_id:e}))(n.id);return{name:`Test ${(new Date).toISOString()}`,steps:{[o.id]:o,[n.id]:n,[e.id]:e}}};function p(){var e,n;const[t,{loading:o,error:r}]=s("workflows",{method:"POST"});return(0,u.jsxs)("div",{children:[(0,u.jsx)("button",{type:"button",onClick:()=>t({body:JSON.stringify(m())}),disabled:o,children:"Create testing workflow"}),r&&(0,u.jsx)("div",{children:null!==(e=null==r||null===(n=r.data)||void 0===n?void 0:n.message)&&void 0!==e?e:"An unknown error occurred"})]})}function w(){var e,n;const[t,{loading:o,error:r}]=s("workflows/create-from-template",{method:"POST"});return(0,u.jsxs)("div",{children:[(0,u.jsx)("button",{type:"button",onClick:()=>t({body:JSON.stringify({name:`Test from template ${(new Date).toISOString()}`,template:"delayed-email-after-signup"})}),disabled:o,children:"Create testing workflow from template"}),r&&(0,u.jsx)("div",{children:null!==(e=null==r||null===(n=r.data)||void 0===n?void 0:n.message)&&void 0!==e?e:"An unknown error occurred"})]})}function v(){const{data:e,loading:n,error:t}=((e,n)=>{const[t,o]=s("workflows",void 0);return(0,i.useEffect)((()=>{t()}),[]),o})();return!e||n?(0,u.jsx)("div",{children:"Loading workflows..."}):t?(0,u.jsxs)("div",{children:["Error: ",t]}):(0,u.jsx)("div",{children:e.data.map((e=>(0,u.jsxs)("div",{children:["[",e.id,"] ",e.name," (",e.status,")",(0,u.jsx)("a",{href:`admin.php?page=mailpoet-automation-editor&id=${e.id}`,children:"EDIT"})]},e.id)))})}function h(){var e,n;const[t,{loading:o,error:r}]=s("system/database",{method:"POST"});return(0,u.jsxs)("div",{children:[(0,u.jsx)("button",{type:"button",onClick:()=>t(),disabled:o,children:"Recreate DB schema (data will be lost)"}),r&&(0,u.jsx)("div",{children:null!==(e=null==r||null===(n=r.data)||void 0===n?void 0:n.message)&&void 0!==e?e:"An unknown error occurred"})]})}function f(){var e,n;const[t,{loading:o,error:r}]=s("system/database",{method:"DELETE"});return(0,u.jsxs)("div",{children:[(0,u.jsx)("button",{type:"button",onClick:async()=>{await t(),window.location.href="/wp-admin/admin.php?page=mailpoet-experimental"},disabled:o,children:"Delete DB schema & deactivate feature"}),r&&(0,u.jsx)("div",{children:null!==(e=null==r||null===(n=r.data)||void 0===n?void 0:n.message)&&void 0!==e?e:"An unknown error occurred"})]})}function g(){return(0,u.jsxs)("div",{children:[(0,u.jsx)(p,{}),(0,u.jsx)(w,{}),(0,u.jsx)(h,{}),(0,u.jsx)(f,{}),(0,u.jsx)(v,{})]})}window.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("mailpoet_automation");e&&r().render((0,u.jsx)(g,{}),e)}))}},function(e){e.O(0,[351],(function(){return 66609,e(e.s=66609)})),e.O()}]);